<h1 class="mb-4 text-center">Products</h1>

<div class="row row-cols-1 row-cols-md-3 g-4">
  <% @products.each do |product| %>
    <div class="col">
      <div class="card h-100 shadow-sm">
        <% if product.image.attached? %>
          <%= link_to url_for(product.image), data: { lightbox: "product-#{product.id}" }, title: product.name do %>
            <%= image_tag product.image.variant(resize_to_limit: [150, 150]), class: "card-img-top mx-auto d-block pt-3", alt: product.name, style: "width:150px; height:150px; object-fit: contain;" %>
          <% end %>
        <% else %>
          <%= image_tag "https://via.placeholder.com/150?text=No+Image", class: "card-img-top mx-auto d-block pt-3", alt: "No image available", style: "width:150px; height:150px; object-fit: contain;" %>
        <% end %>
        <div class="card-body d-flex flex-column justify-content-between">
          <h5 class="card-title text-center"><%= product.name %></h5>
          <p class="card-text text-center text-primary fs-5 fw-bold">MMK<%= product.price %></p>
          <%= button_to "Add to Cart", add_to_cart_path(product), method: :post, class: "btn btn-success w-100" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- Cart icon fixed top-right -->
<div style="position: fixed; top: 20px; right: 20px; z-index: 1050;">
  <%= link_to pos_cart_path, id: "cart-icon", class: "position-relative btn btn-outline-primary rounded-circle p-3 shadow" do %>
    <i class="fas fa-shopping-bag fa-lg"></i>
    <% cart_count = session[:cart]&.values&.sum || 0 %>
    <% if cart_count > 0 %>
      <span class="badge bg-danger rounded-circle position-absolute top-0 start-100 translate-middle px-2 py-1" style="font-size: 0.75rem;">
        <%= cart_count %>
      </span>
    <% end %>
  <% end %>
</div>
